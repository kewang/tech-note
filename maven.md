# Maven

## 什麼是Maven

At first glance Maven can appear to be many things, but in a nutshell Maven is an attempt to apply patterns to a project's build infrastructure in order to promote comprehension and productivity by providing a clear path in the use of best practices. Maven is essentially a project management and comprehension tool and as such provides a way to help with managing:

* Builds
* Documentation
* Reporting
* Dependencies
* SCMs
* Releases
* Distribution

You have walked through the process for setting up, building, testing, packaging, and installing a typical Maven project.

## file structures

```
my-app
|-- pom.xml
`-- src
    |-- main
    |   `-- java
    |       `-- com
    |           `-- mycompany
    |               `-- app
    |                   `-- App.java
    `-- test
        `-- java
            `-- com
                `-- mycompany
                    `-- app
                        `-- AppTest.java
```

## 什麼是pom.xml

## mvn command

* `mvn archetype:generate -DarchetypeGroupId=org.apache.maven.archetypes -DgroupId=com.mycompany.app -DartifactId=my-app`: create architecture
* `mvn compile`: compile your application sources
* `mvn test`: compile test sources and run unit tests
* `mvn test-compile`: only compile test sources
* `mvn package`: create a JAR file
* `mvn install`: install artifact to local repository
* `mvn site`: generate a website for the project
* `mvn clean`: clean `target` folder
* `mvn idea:idea`: generate an IntelliJ IDEA descriptor for the project
* `mvn eclipse:eclipse`: generate an Eclipse descriptor for the project

## lifecycle
### clean lifecycle

* pre-clean: executes processes needed prior to the actual project cleaning
* clean: remove all files generated by the previous build
* post-clean: executes processes needed to finalize the project cleaning

### default lifecycle (without any associated plugin)

* validate: validate the project is correct and all necessary information is available.
* initialize: initialize build state, e.g. set properties or create directories.
* generate-sources: generate any source code for inclusion in compilation.
* process-sources: process the source code, for example to filter any values.
* generate-resources: generate resources for inclusion in the package.
* process-resources: copy and process the resources into the destination directory, ready for packaging.
* compile: compile the source code of the project.
* process-classes: post-process the generated files from compilation, for example to do bytecode enhancement on Java classes.
* generate-test-sources: generate any test source code for inclusion in compilation.
* process-test-sources: process the test source code, for example to filter any values.
* generate-test-resources: create resources for testing.
* process-test-resources: copy and process the resources into the test destination directory.
* test-compile: compile the test source code into the test destination directory
* process-test-classes: post-process the generated files from test compilation, for example to do bytecode enhancement on Java classes. For Maven 2.0.5 and above.
* test: run tests using a suitable unit testing framework. These tests should not require the code be packaged or deployed.
* prepare-package: perform any operations necessary to prepare a package before the actual packaging. This often results in an unpacked, processed version of the package. (Maven 2.1 and above)
* package: take the compiled code and package it in its distributable format, such as a JAR.
* pre-integration-test: perform actions required before integration tests are executed. This may involve things such as setting up the required environment.
* integration-test: process and deploy the package if necessary into an environment where integration tests can be run.
* post-integration-test: perform actions required after integration tests have been executed. This may including cleaning up the environment.
* verify: run any checks to verify the package is valid and meets quality criteria.
* install: install the package into the local repository, for use as a dependency in other projects locally.
* deploy: done in an integration or release environment, copies the final package to the remote repository for sharing with other developers and projects.

### site lifecycle

* pre-site: executes processes needed prior to the actual project site generation
* site: generates the project's site documentation
* post-site: executes processes needed to finalize the site generation, and to prepare for site deployment
* site-deploy: deploys the generated site documentation to the specified web server

### lifecycle references

* http://maven.apache.org/ref/3.1.1/maven-core/lifecycles.html
* http://maven.apache.org/ref/3.1.1/maven-core/default-bindings.html

## use plugin

### configure the Java compiler example

```xml
<build>
  <plugins>
    <plugin>
      <groupId>org.apache.maven.plugins</groupId>
      <artifactId>maven-compiler-plugin</artifactId>
      <version>2.5.1</version>
      <configuration>
        <source>1.6</source>
        <target>1.6</target>
      </configuration>
    </plugin>
  </plugins>
</build>
```

### filter resource files

You can inject all pom properties to Java source code

```xml
<build>
  <resources>
    <resource>
      <directory>src/main/resources</directory>
      <filtering>true</filtering>
    </resource>
  </resources>
</build>
```

## build multi-project

### parent pom.xml

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
                      http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <groupId>com.mycompany.app</groupId>
  <artifactId>app</artifactId>
  <version>1.0-SNAPSHOT</version>
  <packaging>pom</packaging>

  <modules>
    <module>my-app</module>
    <module>my-webapp</module>
  </modules>
</project>
```

### subproject if depend on another one

```xml
<dependencies>
  <dependency>
    <groupId>com.mycompany.app</groupId>
    <artifactId>my-app</artifactId>
    <version>1.0-SNAPSHOT</version>
  </dependency>
</dependencies>
```

### determine subproject's parent pom

```xml
<parent>
  <groupId>com.mycompany.app</groupId>
  <artifactId>app</artifactId>
  <version>1.0-SNAPSHOT</version>
</parent>
```

## 如何publish自己的library到maven repository上
## sonatype是什麼？

http://www.apache.org/dev/publishing-maven-artifacts.html
https://docs.sonatype.org/display/Repository/How+To+Generate+PGP+Signatures+With+Maven
http://datumedge.blogspot.tw/2012/05/publishing-from-github-to-maven-central.html